/*! popinGen 07-12-2014 */
!function(a,b,c,d){"use strict";function e(b){this.element=a(b.selector),this.options=a.extend({},h,b),this._defaults=h,this._name=g,this.layerID="#"+this.options.idLayer,f=this,this.init()}var f,g="popinGen",h={selector:null,target:"",mode:"popin",idElem:"",targetId:"",idPrefix:"popinContainer_",zIndex:1e4,classContainer:"",eventStart:"click",eventStop:"",toggle:!1,ajaxMode:!1,ajaxMethod:function(){},callbackMethod:function(){},callbackMethodAfterCreate:function(){},callbackMethodOpen:function(){},callbackMethodClose:function(){},ajaxLoaderLink:"",multiContent:!1,autoclose:!1,timeToAutoclose:3e3,idLayer:"layerPopinGen",closeOnLayer:!0,backgroundLayerColor:"#000",bindESC:!1,scrollPopin:!0,fullscreen:!1,timer:0,customPosition:!1,relativePosition:{left:-1,top:-1},outerClose:!1};e.prototype={init:function(){return""===this.options.target?(console.error("The parameter \"target\" can't be empty, it's required for plugin works"),!1):(this.options.targetId=this.hashControl(this.options),this.hideClassControl(),"layer"!==this.options.mode&&this.generateLayer(this.element,this.options),void this.bindEvents(this.element,this.options))},bindEvents:function(d,e){function g(b,c){var g=b.originalEvent?b.originalEvent.type:"trigger";f.generateContainer(c,e),"layer"===e.mode?(a(c).data("alreadyCreate")&&f.popinPosition(c,e),a(c).data("alreadyOpen")||g!==e.eventStart?(a(c).data("alreadyOpen",!1),f.hidePopinAndLayer(d,e)):(f.showPopinContent(c,e),e.toggle&&a(c).data("alreadyOpen",!0),e.outerClose&&a(e.idElem).focus())):(e.fullscreen&&a("body").css("overflow","hidden"),f.showTransparencyLayer(),f.showPopinContent(c,e)),e.callbackMethodOpen(c,e)}var h,i;"click"===e.eventStart&&"layer"===e.mode&&e.outerClose&&(e.eventStart="mousedown",a(e.selector).click(function(a){a.preventDefault()})),a("html").on(e.eventStart,e.selector,function(a){a.preventDefault(),a.stopImmediatePropagation();var b=this;e.timer>0?i=setTimeout(g(a,b),e.timer):g(a,b),clearTimeout(h),e.autoclose&&setTimeout(function(){f.hidePopinAndLayer(d,e)},e.timeToAutoclose)}),e.closeOnLayer&&"layer"!==e.mode&&a("body").on("click",this.layerID,function(a){a.preventDefault(),f.hidePopinAndLayer(d,e)}),("mouseenter"===e.eventStart||"mouseover"===e.eventStart&&"layer"===e.mode)&&(a("body").on("mouseleave",e.selector,function(){clearTimeout(i),h=setTimeout(function(){f.hidePopinAndLayer(d,e)},parseInt(f.options.timer/2,10))}),e.eventStop="mouseleave",a("body").on("mouseenter",e.targetId,function(){clearTimeout(h)})),""!==e.eventStop&&a("body").on(f.options.eventStop,f.options.targetId,function(a){a.preventDefault(),h=setTimeout(function(){f.hidePopinAndLayer(d,e)},f.options.timer)}),a("body").on("click",".close",function(b){b.preventDefault(),a(this).trigger("close")}),e.bindESC&&"layer"!==e.mode&&a(b).on("keyup",c,function(a){a.preventDefault(),27===a.keyCode&&f.hidePopinAndLayer(d,e)})},bindFocusBlurEvents:function(b,c){(c.outerClose||c.toggle&&"layer"===c.mode)&&("input"!==b.tagName.toLowerCase()&&a(b).attr("tabindex","-1"),a("body").on("focus",c.idElem,function(d){d.preventDefault(),a(c.idElem).css("outline","none"),a(b).data("alreadyOpen",!0)}),a("body").on("blur",c.idElem,function(d){d.preventDefault();c.selector.substring(1,c.selector.length);f.hidePopinAndLayer(b,c),(c.toggle||c.outerClose)&&a(b).data("alreadyOpen",!1)}))},generateLayer:function(b,c){var d;a(this.layerID).size()<1&&(d=this.getMaxHeight(),a("body").append('<div id="'+c.idLayer+'"></div>'),a(this.layerID).css({zIndex:9999,background:c.backgroundLayerColor,opacity:"0.3",height:d+"px",width:"100%",position:"absolute",top:0,left:0,display:"none"})),c.ajaxMode&&a("#Ajaxloading").size()<1&&"layer"!==c.mode&&""!==c.ajaxLoaderLink&&(a("body").append("<img src='"+c.ajaxLoaderLink+"' alt='loader' id='Ajaxloading' />"),a("#Ajaxloading").css({zIndex:1e4,position:"absolute",top:0,left:0,display:"none"}))},generateContainer:function(c,d){var e,g,h;if(e=this.generatedId(d),g=d.ajaxLoaderLink,d.idElem="#"+e,h=d.targetId,a(d.idElem).size()<1){if(a(c).data("alreadyCreate",!1),a("body").append('<div id="'+e+'" tabindex="-1"></div>'),a(d.idElem).css({"z-index":d.zIndex,position:"absolute",top:"0",left:"-999em",visibility:"hidden"}),""!==d.classContainer&&a(d.idElem).addClass(d.classContainer),""===d.target||""===d.idElem)return void console.error("WARNING : Can't work ! target or ID automaticaly generated are empty");a(h).appendTo(d.idElem).css("display","block"),this.popinPosition(c,d),"layer"!==d.mode?(a(d.idElem).css("display","none"),b.onresize=function(){f.popinPosition(c,d)}):(d.ajaxMode&&a("#AjaxloadingLayer").size()<1&&""!==g&&(a(h).append("<img src='"+g+"' alt='loader' id='AjaxloadingLayer' />"),a("#AjaxloadingLayer").css({"z-index":"1000",margin:"0 auto",display:"none"})),d.outerClose&&f.bindFocusBlurEvents(c,d)),d.callbackMethodAfterCreate(c,d)}else a(c).data("alreadyCreate",!0)},popinPosition:function(e,f){var g,h,i,j,k,l,m,n,o,p;if(f.customPosition){if(l=f.relativePosition,m=a(e).offset(),n=parseInt(m.top+20,10),o=m.left,-1!==l.left)for(p in l)switch(p){case"left":o=l.left>0?parseInt(l.left+o,10):o=parseInt(o+l.left,10);break;case"top":n=l.top>0?parseInt(l.top+n,10):parseInt(n+l.top,10);break;case"right":o=l.right>0?parseInt(l.right+o,10):parseInt(o+l.right,10);break;case"bottom":n=l.bottom>0?parseInt(l.bottom+n,10):parseInt(n+l.bottom,10)}a(f.idElem).css({top:n,left:o})}else g=a(f.idElem),h={top:0,left:0},i=g.width(),j=g.height(),0!==i&&0!==j&&(k=b.pageYOffset!==d?b.pageYOffset:(c.documentElement||c.body.parentNode||c.body).scrollTop,f.scrollPopin&&(k=0),h.left=parseInt((a(b).width()-i)/2,10),h.top=parseInt((a(b).height()-j)/2+k,10),f.fullscreen?h.top<0&&(h.top=0):h.top<30&&(h.top=30),a(f.idElem).css({top:h.top,left:h.left})),f.scrollPopin&&a(f.idElem).css("position","fixed");a(this.layerID).height(this.getMaxHeight())},layerLoaderPosition:function(){var b,c,d,e,g,h,i,j,k;b=a(f.options.idElem),c=b.width(),d=b.height(),a("#transparentLayerForLoader").size()>0&&a("#transparentLayerForLoader").remove(),b.append('<div id="transparentLayerForLoader"></div>'),a("#transparentLayerForLoader").css({zIndex:999,background:"#FFF",opacity:"0.5",height:d+"px",width:"100%",position:"absolute",top:0,left:0,display:"none"}).show(),a(".ajaxLoaderStyle",f.options.idElem).size()>0&&a(".ajaxLoaderStyle",f.options.idElem).remove(),a(f.options.idElem).append('<img src="'+f.options.ajaxLoaderLink+'" alt="loader" id="AjaxloadingLayer" class="ajaxLoaderStyle" />'),e=a(".ajaxLoaderStyle"),k=new Image,k.src=e.prop("src"),g=k.width,h=k.height,i=c/2-g/2,j=d/2-h/2,e.css({zIndex:1e3,margin:"0 auto",display:"block",position:"absolute",top:j+"px",left:i+"px"}).show(),b.show()},showTransparencyLayer:function(){a(this.layerID).show()},hidePopinAndLayer:function(b,d){""!==d.idElem&&(a(d.idElem).hide(),"layer"!==d.mode&&a(this.layerID).hide(),""!==d.ajaxLoaderLink&&a("#Ajaxloading").hide(),d.fullscreen&&a("body").css("overflow","auto"),d.callbackMethodClose(b,d)),"layer"!==d.mode&&d.bindESC&&a(c).off("keyup")},getMaxHeight:function(){var d=Math.max(a(c).height(),a(b).height(),c.documentElement.clientHeight);return d},jSCallBack:function(b,c){a(c.targetId).empty().append(b),c.customPosition||f.popinPosition(null,c),a(c.idElem).css("visibility","visible").show(),f.options.callbackMethod(),f.hideAjaxLoader()},viewAjaxLoader:function(){var d,e,f,g,h;d=a("#Ajaxloading"),e={top:0,left:0},f=d.width(),g=d.height(),h=a.support.boxSizing?b.scrollY:h=c.documentElement.scrollTop,e.left=parseInt((a(b).width()-f)/2,10),e.top=parseInt((a(b).height()-g)/2+h,10),d.css({top:e.top,left:e.left}).show()},showPopinContent:function(b,c){if(c.ajaxMode&&!a(b).data("alreadyCreate")?("layer"!==c.mode?this.viewAjaxLoader():a("#AjaxloadingLayer,"+c.idElem).css("display","block"),this.popinPosition(b,c),c.multiContent||c.ajaxMethod(b,this,c)):a(c.idElem).css("visibility","visible").show(),c.multiContent&&c.ajaxMode){var d=c.ajaxLoaderLink;""!==d&&("layer"===c.mode&&this.layerLoaderPosition(),"popin"===c.mode&&this.viewAjaxLoader()),c.ajaxMethod(b,this,c)}},hideAjaxLoader:function(){a("#Ajaxloading, #AjaxloadingLayer, #transparentLayerForLoader").hide(),a(f.options.idElem).show()},generatedId:function(a){return a.idPrefix+a.targetId.substring(1)},hideClassControl:function(){a(this.options.targetId).is(":visible")&&a(this.options.targetId).css("display","none")},hashControl:function(a){return-1===a.target.indexOf("#")?"#"+a.target:a.target}},a.fn[g]=function(b){return b.selector?(a(b.selector).data("plugin_"+g,new e(b)),this):(console.error("The parameter \"selector\" can't be empty, it's required for plugin works"),!1)}}(jQuery,window,document);